_format_version: "3.0"
_transform: true

services:
  # Auth Service
  - name: auth-service
    url: http://auth-service:8000
    routes:
      - name: auth-routes
        paths:
          - /api/v1/auth
        strip_path: false
    plugins:
      - name: cors
        config:
          origins:
            - "*"
          methods:
            - GET
            - POST
            - PUT
            - DELETE
            - PATCH
            - OPTIONS
          headers:
            - Accept
            - Authorization
            - Content-Type
          exposed_headers:
            - X-Auth-Token
          credentials: true
          max_age: 3600
      - name: rate-limiting
        config:
          minute: 60
          policy: local

  # User Service
  - name: user-service
    url: http://user-service:8000
    routes:
      - name: user-routes
        paths:
          - /api/v1/users
          - /api/v1/roles
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 100

  # Organization Service
  - name: organization-service
    url: http://organization-service:8000
    routes:
      - name: organization-routes
        paths:
          - /api/v1/organizations
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 100

  # Instance Service
  - name: instance-service
    url: http://instance-service:8000
    routes:
      - name: instance-routes
        paths:
          - /api/v1/instances
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 200

  # Analysis Service
  - name: analysis-service
    url: http://analysis-service:8000
    routes:
      - name: analysis-routes
        paths:
          - /api/v1/analysis
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 50
          hour: 500

  # Insights Service
  - name: insights-service
    url: http://insights-service:8000
    routes:
      - name: insights-routes
        paths:
          - /api/v1/insights
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 100

  # Dashboard Service
  - name: dashboard-service
    url: http://dashboard-service:8000
    routes:
      - name: dashboard-routes
        paths:
          - /api/v1/dashboard
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 200

  # Audit Service
  - name: audit-service
    url: http://audit-service:8000
    routes:
      - name: audit-routes
        paths:
          - /api/v1/audit
        strip_path: false
    plugins:
      - name: cors
      - name: rate-limiting
        config:
          minute: 100

# Global plugins
plugins: []
